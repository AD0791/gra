// This Pine Scriptâ„¢ code is subject to the terms of the Mozilla Public License 2.0
// Â© Alexandro Disla - Get Rich Aggressively v4
// Precision Futures Scalping System for NQ, YM, GC

//@version=6
indicator("Get_rich_aggressively", shorttitle="GRA", overlay=true, max_labels_count=500, max_lines_count=500)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  INSTRUMENT DETECTION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Auto-detect instrument and set tick/point values
var float ticksPerPoint = 4.0      // Default NQ
var float tickValue = 0.25         // Default NQ
var string instrumentType = "NQ"

// Detect instrument from symbol
if str.contains(syminfo.ticker, "NQ") or str.contains(syminfo.ticker, "MNQ")
    ticksPerPoint := 4.0
    tickValue := 0.25
    instrumentType := "NQ"
else if str.contains(syminfo.ticker, "YM") or str.contains(syminfo.ticker, "MYM")
    ticksPerPoint := 1.0
    tickValue := 1.0
    instrumentType := "YM"
else if str.contains(syminfo.ticker, "GC") or str.contains(syminfo.ticker, "MGC")
    ticksPerPoint := 10.0
    tickValue := 0.10
    instrumentType := "GC"
else if str.contains(syminfo.ticker, "ES") or str.contains(syminfo.ticker, "MES")
    ticksPerPoint := 4.0
    tickValue := 0.25
    instrumentType := "ES"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  CONFIGURATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string GRP_TIER = "â•â•â•â•â•â•â•â•â•â•â• TIER THRESHOLDS â•â•â•â•â•â•â•â•â•â•â•"
float sTierPoints = input.float(100.0, "S-Tier (Points)", minval=50, maxval=500, step=10, group=GRP_TIER,
     tooltip="Hold position longer, watch next candle")
float aTierPoints = input.float(50.0, "A-Tier (Points)", minval=20, maxval=100, step=5, group=GRP_TIER,
     tooltip="Hold a bit longer")
float bTierPoints = input.float(10.0, "B-Tier (Points)", minval=5, maxval=50, step=1, group=GRP_TIER,
     tooltip="Close position quick")

string GRP_VOLUME = "â•â•â•â•â•â•â•â•â•â•â• VOLUME FILTER â•â•â•â•â•â•â•â•â•â•â•"
int volMaLength = input.int(20, "Volume MA Length", minval=5, maxval=50, group=GRP_VOLUME)
float minVolRatio = input.float(1.3, "Min Volume Ratio to Signal", minval=1.0, maxval=3.0, step=0.1, group=GRP_VOLUME,
     tooltip="No signal without this volume multiple")
float strongVolRatio = input.float(2.0, "Strong Volume Ratio", minval=1.5, maxval=5.0, step=0.1, group=GRP_VOLUME)

string GRP_DELTA = "â•â•â•â•â•â•â•â•â•â•â• DELTA SENSITIVITY â•â•â•â•â•â•â•â•â•â•â•"
float deltaThreshold = input.float(0.55, "Delta Dominance Threshold", minval=0.51, maxval=0.75, step=0.01, group=GRP_DELTA,
     tooltip="Buy pressure must exceed this % to confirm direction")
string analysisTimeframe = input.timeframe("1", "Intrabar Analysis TF", group=GRP_DELTA)

string GRP_SESSION = "â•â•â•â•â•â•â•â•â•â•â• SESSION FILTER â•â•â•â•â•â•â•â•â•â•â•"
bool onlyKeySession = input.bool(true, "Only Signal During Key Sessions", group=GRP_SESSION)
string sessionTimezone = input.string("America/New_York", "Timezone", 
     options=["America/New_York", "America/Chicago", "Europe/London", "UTC"], group=GRP_SESSION)
string londonWindow = input.string("0300-0500", "London Open Window", group=GRP_SESSION)
string nyWindow = input.string("0930-1130", "NY Open Window", group=GRP_SESSION)

string GRP_SL = "â•â•â•â•â•â•â•â•â•â•â• TRAILING STOP â•â•â•â•â•â•â•â•â•â•â•"
float slBufferTicks = input.float(4.0, "SL Buffer (Ticks)", minval=1, maxval=20, step=1, group=GRP_SL,
     tooltip="Ticks beyond candle wick for stop loss")
bool showTrailingSL = input.bool(true, "Show Trailing SL Lines", group=GRP_SL)
int slLineLength = input.int(5, "SL Line Length (Bars)", minval=2, maxval=20, group=GRP_SL)

string GRP_VISUAL = "â•â•â•â•â•â•â•â•â•â•â• VISUALS â•â•â•â•â•â•â•â•â•â•â•"
color sTierColor = input.color(color.new(#FFD700, 0), "S-Tier Color (Gold)", group=GRP_VISUAL)
color aTierColor = input.color(color.new(#00E676, 0), "A-Tier Color (Green)", group=GRP_VISUAL)
color bTierColor = input.color(color.new(#FFC107, 0), "B-Tier Color (Yellow)", group=GRP_VISUAL)
color longColor = input.color(color.new(#00E676, 0), "Long Arrow Color", group=GRP_VISUAL)
color shortColor = input.color(color.new(#FF5252, 0), "Short Arrow Color", group=GRP_VISUAL)
color slColor = input.color(color.new(#FF5252, 50), "Stop Loss Line Color", group=GRP_VISUAL)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  CORE CALCULATIONS  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Candle Metrics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
float candleRange = high - low
float bodySize = math.abs(close - open)
float candlePoints = candleRange / tickValue / ticksPerPoint
bool isBullishCandle = close > open
bool isBearishCandle = close < open

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Tier Classification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string currentTier = candlePoints >= sTierPoints ? "S" : candlePoints >= aTierPoints ? "A" : candlePoints >= bTierPoints ? "B" : "X"
bool isTierCandle = currentTier != "X"

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Volume Analysis â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
float avgVolume = ta.sma(volume, volMaLength)
float volumeRatio = avgVolume > 0 ? volume / avgVolume : 1.0
bool hasMinVolume = volumeRatio >= minVolRatio
bool hasStrongVolume = volumeRatio >= strongVolRatio

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Volume Delta (Intrabar) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var float intrabarBuyVol = 0.0
var float intrabarSellVol = 0.0
var float volumeDelta = 0.0

if timeframe.isintraday
    [ltfO, ltfC, ltfV, ltfH, ltfL] = request.security_lower_tf(syminfo.tickerid, analysisTimeframe, [open, close, volume, high, low])
    
    if array.size(ltfC) > 0
        float tempBuy = 0.0
        float tempSell = 0.0
        
        for i = 0 to array.size(ltfC) - 1
            float ltfRange = array.get(ltfH, i) - array.get(ltfL, i)
            float ltfClose = array.get(ltfC, i)
            float ltfOpen = array.get(ltfO, i)
            float ltfVol = array.get(ltfV, i)
            
            if ltfRange > 0
                tempBuy += ((ltfClose - array.get(ltfL, i)) / ltfRange) * ltfVol
                tempSell += ((array.get(ltfH, i) - ltfClose) / ltfRange) * ltfVol
            else
                if ltfClose >= ltfOpen
                    tempBuy += ltfVol
                else
                    tempSell += ltfVol
        
        intrabarBuyVol := tempBuy
        intrabarSellVol := tempSell
        volumeDelta := tempBuy - tempSell
    else
        float buyP = candleRange > 0 ? ((close - low) / candleRange) * volume : volume * 0.5
        float sellP = candleRange > 0 ? ((high - close) / candleRange) * volume : volume * 0.5
        intrabarBuyVol := buyP
        intrabarSellVol := sellP
        volumeDelta := buyP - sellP
else
    float buyP = candleRange > 0 ? ((close - low) / candleRange) * volume : volume * 0.5
    float sellP = candleRange > 0 ? ((high - close) / candleRange) * volume : volume * 0.5
    intrabarBuyVol := buyP
    intrabarSellVol := sellP
    volumeDelta := buyP - sellP

// Delta dominance calculation
float totalVol = intrabarBuyVol + intrabarSellVol
float buyDominance = totalVol > 0 ? intrabarBuyVol / totalVol : 0.5
float sellDominance = totalVol > 0 ? intrabarSellVol / totalVol : 0.5

// Direction confirmation (combine candle + delta)
bool deltaConfirmsBull = buyDominance >= deltaThreshold
bool deltaConfirmsBear = sellDominance >= deltaThreshold
bool confirmedLong = isBullishCandle and deltaConfirmsBull
bool confirmedShort = isBearishCandle and deltaConfirmsBear

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  SESSION FILTER  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bool inLondonOpen = not na(time(timeframe.period, londonWindow, sessionTimezone))
bool inNYOpen = not na(time(timeframe.period, nyWindow, sessionTimezone))
bool inKeySession = inLondonOpen or inNYOpen
bool sessionAllows = onlyKeySession ? inKeySession : true

// Session start detection
bool londonStart = na(time(timeframe.period, londonWindow, sessionTimezone)[1]) and inLondonOpen and timeframe.isintraday
bool nyStart = na(time(timeframe.period, nyWindow, sessionTimezone)[1]) and inNYOpen and timeframe.isintraday

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  SIGNAL LOGIC  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Final signal conditions
bool longSignal = isTierCandle and hasMinVolume and confirmedLong and sessionAllows
bool shortSignal = isTierCandle and hasMinVolume and confirmedShort and sessionAllows

// Tier-specific signals
bool sTierLong = longSignal and currentTier == "S"
bool aTierLong = longSignal and currentTier == "A"
bool bTierLong = longSignal and currentTier == "B"

bool sTierShort = shortSignal and currentTier == "S"
bool aTierShort = shortSignal and currentTier == "A"
bool bTierShort = shortSignal and currentTier == "B"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  TRAILING STOP CALCULATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

float slBuffer = slBufferTicks * tickValue
float longSL = low - slBuffer
float shortSL = high + slBuffer

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  VISUALIZATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Tier Badge Color â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
color tierColor = currentTier == "S" ? sTierColor : currentTier == "A" ? aTierColor : currentTier == "B" ? bTierColor : na

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LONG SIGNALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// S-Tier Long
plotshape(sTierLong, "S-Tier Long Badge", style=shape.square, location=location.belowbar, 
     color=sTierColor, size=size.tiny, text="S", textcolor=color.black)
plotshape(sTierLong, "S-Tier Long Arrow", style=shape.triangleup, location=location.belowbar, 
     color=longColor, size=size.tiny, offset=0)

// A-Tier Long
plotshape(aTierLong, "A-Tier Long Badge", style=shape.square, location=location.belowbar, 
     color=aTierColor, size=size.tiny, text="A", textcolor=color.black)
plotshape(aTierLong, "A-Tier Long Arrow", style=shape.triangleup, location=location.belowbar, 
     color=longColor, size=size.tiny, offset=0)

// B-Tier Long
plotshape(bTierLong, "B-Tier Long Badge", style=shape.square, location=location.belowbar, 
     color=bTierColor, size=size.tiny, text="B", textcolor=color.black)
plotshape(bTierLong, "B-Tier Long Arrow", style=shape.triangleup, location=location.belowbar, 
     color=longColor, size=size.tiny, offset=0)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SHORT SIGNALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// S-Tier Short
plotshape(sTierShort, "S-Tier Short Badge", style=shape.square, location=location.abovebar, 
     color=sTierColor, size=size.tiny, text="S", textcolor=color.black)
plotshape(sTierShort, "S-Tier Short Arrow", style=shape.triangledown, location=location.abovebar, 
     color=shortColor, size=size.tiny, offset=0)

// A-Tier Short
plotshape(aTierShort, "A-Tier Short Badge", style=shape.square, location=location.abovebar, 
     color=aTierColor, size=size.tiny, text="A", textcolor=color.black)
plotshape(aTierShort, "A-Tier Short Arrow", style=shape.triangledown, location=location.abovebar, 
     color=shortColor, size=size.tiny, offset=0)

// B-Tier Short
plotshape(bTierShort, "B-Tier Short Badge", style=shape.square, location=location.abovebar, 
     color=bTierColor, size=size.tiny, text="B", textcolor=color.black)
plotshape(bTierShort, "B-Tier Short Arrow", style=shape.triangledown, location=location.abovebar, 
     color=shortColor, size=size.tiny, offset=0)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TRAILING STOP LINES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if showTrailingSL and longSignal
    line.new(bar_index, longSL, bar_index + slLineLength, longSL, 
         color=slColor, width=2, style=line.style_solid)
    label.new(bar_index + slLineLength, longSL, text="SL", 
         style=label.style_label_left, color=color.new(slColor, 50), textcolor=color.white, size=size.tiny)

if showTrailingSL and shortSignal
    line.new(bar_index, shortSL, bar_index + slLineLength, shortSL, 
         color=slColor, width=2, style=line.style_solid)
    label.new(bar_index + slLineLength, shortSL, text="SL", 
         style=label.style_label_left, color=color.new(slColor, 50), textcolor=color.white, size=size.tiny)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SESSION MARKERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
plotshape(londonStart, "London Open", shape.diamond, location.abovebar, 
     color.new(#2196F3, 0), size=size.tiny, text="L", textcolor=color.white)
plotshape(nyStart, "NY Open", shape.diamond, location.abovebar, 
     color.new(#4CAF50, 0), size=size.tiny, text="N", textcolor=color.white)

// Session background (subtle)
bgcolor(inLondonOpen ? color.new(#2196F3, 95) : na, title="London Window")
bgcolor(inNYOpen ? color.new(#4CAF50, 95) : na, title="NY Window")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  INFO PANEL  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var table infoPanel = table.new(position.top_right, 2, 8, bgcolor=color.new(color.black, 85), border_width=1, border_color=color.new(color.gray, 60))

if barstate.islast
    // Header
    table.cell(infoPanel, 0, 0, "GRA v4", text_color=color.white, text_size=size.small, bgcolor=color.new(#FFD700, 70))
    table.cell(infoPanel, 1, 0, instrumentType, text_color=color.white, text_size=size.small, bgcolor=color.new(#FFD700, 70))
    
    // Points
    table.cell(infoPanel, 0, 1, "Points", text_color=color.gray, text_size=size.tiny)
    string ptsStr = str.tostring(candlePoints, "#.#")
    color ptsColor = currentTier == "S" ? sTierColor : currentTier == "A" ? aTierColor : currentTier == "B" ? bTierColor : color.gray
    table.cell(infoPanel, 1, 1, ptsStr, text_color=ptsColor, text_size=size.tiny)
    
    // Tier
    table.cell(infoPanel, 0, 2, "Tier", text_color=color.gray, text_size=size.tiny)
    table.cell(infoPanel, 1, 2, currentTier, text_color=tierColor, text_size=size.tiny)
    
    // Volume
    table.cell(infoPanel, 0, 3, "Vol", text_color=color.gray, text_size=size.tiny)
    string volStr = str.tostring(volumeRatio, "#.#") + "x"
    color volColor = hasStrongVolume ? color.yellow : hasMinVolume ? color.green : color.red
    table.cell(infoPanel, 1, 3, volStr, text_color=volColor, text_size=size.tiny)
    
    // Delta
    table.cell(infoPanel, 0, 4, "Delta", text_color=color.gray, text_size=size.tiny)
    string deltaStr = buyDominance > sellDominance ? str.tostring(buyDominance * 100, "#") + "% B" : str.tostring(sellDominance * 100, "#") + "% S"
    color deltaColor = deltaConfirmsBull ? longColor : deltaConfirmsBear ? shortColor : color.gray
    table.cell(infoPanel, 1, 4, deltaStr, text_color=deltaColor, text_size=size.tiny)
    
    // Direction
    table.cell(infoPanel, 0, 5, "Dir", text_color=color.gray, text_size=size.tiny)
    string dirStr = confirmedLong ? "LONG" : confirmedShort ? "SHORT" : "---"
    color dirColor = confirmedLong ? longColor : confirmedShort ? shortColor : color.gray
    table.cell(infoPanel, 1, 5, dirStr, text_color=dirColor, text_size=size.tiny)
    
    // Session
    table.cell(infoPanel, 0, 6, "Sess", text_color=color.gray, text_size=size.tiny)
    string sessStr = inNYOpen ? "NY!" : inLondonOpen ? "LDN!" : "---"
    color sessColor = inKeySession ? color.yellow : color.gray
    table.cell(infoPanel, 1, 6, sessStr, text_color=sessColor, text_size=size.tiny)
    
    // Signal
    table.cell(infoPanel, 0, 7, "Signal", text_color=color.gray, text_size=size.tiny)
    string sigStr = sTierLong ? "Sâ–²" : aTierLong ? "Aâ–²" : bTierLong ? "Bâ–²" : sTierShort ? "Sâ–¼" : aTierShort ? "Aâ–¼" : bTierShort ? "Bâ–¼" : "---"
    color sigColor = longSignal ? longColor : shortSignal ? shortColor : color.gray
    table.cell(infoPanel, 1, 7, sigStr, text_color=sigColor, text_size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  ALERTS  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// S-Tier Alerts (Hold longer)
alertcondition(sTierLong, title="S-TIER LONG", message="ğŸ¥‡ S-TIER LONG on {{ticker}} at {{close}} | {{volume}} vol | HOLD - Watch next candle!")
alertcondition(sTierShort, title="S-TIER SHORT", message="ğŸ¥‡ S-TIER SHORT on {{ticker}} at {{close}} | {{volume}} vol | HOLD - Watch next candle!")

// A-Tier Alerts (Hold a bit)
alertcondition(aTierLong, title="A-TIER LONG", message="ğŸ¥ˆ A-TIER LONG on {{ticker}} at {{close}} | Hold a bit longer")
alertcondition(aTierShort, title="A-TIER SHORT", message="ğŸ¥ˆ A-TIER SHORT on {{ticker}} at {{close}} | Hold a bit longer")

// B-Tier Alerts (Close quick)
alertcondition(bTierLong, title="B-TIER LONG", message="ğŸ¥‰ B-TIER LONG on {{ticker}} at {{close}} | CLOSE QUICK!")
alertcondition(bTierShort, title="B-TIER SHORT", message="ğŸ¥‰ B-TIER SHORT on {{ticker}} at {{close}} | CLOSE QUICK!")

// Session Alerts
alertcondition(londonStart, title="LONDON OPEN", message="ğŸ”µ London session starting on {{ticker}}")
alertcondition(nyStart, title="NY OPEN", message="ğŸŸ¢ NY session starting on {{ticker}}")

// Combined Alert
if longSignal or shortSignal
    string dir = longSignal ? "LONG" : "SHORT"
    string tier = currentTier
    string action = currentTier == "S" ? "HOLD LONGER" : currentTier == "A" ? "HOLD A BIT" : "CLOSE QUICK"
    float sl = longSignal ? longSL : shortSL
    alert("GRA | " + tier + "-TIER " + dir + " | " + syminfo.ticker + " @ " + str.tostring(close, format.mintick) + " | SL: " + str.tostring(sl, format.mintick) + " | " + action, alert.freq_once_per_bar_close)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  END OF INDICATOR  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
