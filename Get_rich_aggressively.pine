// This Pine Scriptâ„¢ code is subject to the terms of the Mozilla Public License 2.0
// Â© Alexandro Disla - Get Rich Aggressively v4
// Precision Futures Scalping | NQ â€¢ YM â€¢ GC

//@version=6
indicator("Get_rich_aggressively", shorttitle="GRA", overlay=true, max_labels_count=500, max_lines_count=500)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  INSTRUMENT DETECTION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var float ticksPerPoint = 4.0
var float tickValue = 0.25
var string instrumentType = "NQ"

if str.contains(str.upper(syminfo.ticker), "NQ") or str.contains(str.upper(syminfo.ticker), "MNQ")
    ticksPerPoint := 4.0
    tickValue := 0.25
    instrumentType := "NQ"
else if str.contains(str.upper(syminfo.ticker), "YM") or str.contains(str.upper(syminfo.ticker), "MYM")
    ticksPerPoint := 1.0
    tickValue := 1.0
    instrumentType := "YM"
else if str.contains(str.upper(syminfo.ticker), "GC") or str.contains(str.upper(syminfo.ticker), "MGC")
    ticksPerPoint := 10.0
    tickValue := 0.10
    instrumentType := "GC"
else if str.contains(str.upper(syminfo.ticker), "ES") or str.contains(str.upper(syminfo.ticker), "MES")
    ticksPerPoint := 4.0
    tickValue := 0.25
    instrumentType := "ES"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  CONFIGURATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string GRP_TIER = "â•â•â•â•â•â•â•â•â•â•â• TIER THRESHOLDS â•â•â•â•â•â•â•â•â•â•â•"
float sTierPoints = input.float(100.0, "S-Tier (Points)", minval=10, maxval=500, step=10, group=GRP_TIER,
     tooltip="100+ pts: HOLD LONGER - Watch next candle")
float aTierPoints = input.float(50.0, "A-Tier (Points)", minval=5, maxval=100, step=5, group=GRP_TIER,
     tooltip="50-99 pts: HOLD A BIT - Trail to breakeven")
float bTierPoints = input.float(10.0, "B-Tier (Points)", minval=1, maxval=50, step=1, group=GRP_TIER,
     tooltip="10-49 pts: CLOSE QUICK - Take profit NOW")

string GRP_VOLUME = "â•â•â•â•â•â•â•â•â•â•â• VOLUME FILTER â•â•â•â•â•â•â•â•â•â•â•"
int volMaLength = input.int(20, "Volume MA Length", minval=5, maxval=50, group=GRP_VOLUME)
float minVolRatio = input.float(1.3, "Min Volume to Signal", minval=1.0, maxval=3.0, step=0.1, group=GRP_VOLUME,
     tooltip="No signal if volume below this multiple")
float strongVolRatio = input.float(2.0, "Strong Volume", minval=1.5, maxval=5.0, step=0.1, group=GRP_VOLUME)

string GRP_DELTA = "â•â•â•â•â•â•â•â•â•â•â• DELTA FILTER â•â•â•â•â•â•â•â•â•â•â•"
float deltaThreshold = input.float(0.55, "Delta Dominance %", minval=0.51, maxval=0.75, step=0.01, group=GRP_DELTA,
     tooltip="55% = buyers/sellers must control 55%+ of volume")
string analysisTimeframe = input.timeframe("1", "Intrabar TF", group=GRP_DELTA)

string GRP_SESSION = "â•â•â•â•â•â•â•â•â•â•â• SESSION â•â•â•â•â•â•â•â•â•â•â•"
bool onlyKeySession = input.bool(true, "Only Signal in Key Sessions", group=GRP_SESSION)
string sessionTimezone = input.string("America/New_York", "Timezone", 
     options=["America/New_York", "America/Chicago", "Europe/London", "UTC"], group=GRP_SESSION)
string londonWindow = input.string("0300-0500", "London Window", group=GRP_SESSION)
string nyWindow = input.string("0930-1130", "NY Window", group=GRP_SESSION)

string GRP_SL = "â•â•â•â•â•â•â•â•â•â•â• STOP LOSS â•â•â•â•â•â•â•â•â•â•â•"
float slBufferTicks = input.float(2.0, "SL Buffer (Ticks)", minval=0, maxval=10, step=1, group=GRP_SL,
     tooltip="Extra buffer beyond calculated SL level")
bool showSL = input.bool(true, "Show SL Lines", group=GRP_SL)
int slLineLength = input.int(8, "SL Line Length", minval=3, maxval=20, group=GRP_SL)

string GRP_VISUAL = "â•â•â•â•â•â•â•â•â•â•â• COLORS â•â•â•â•â•â•â•â•â•â•â•"
color sTierColor = input.color(color.new(#FFD700, 0), "S-Tier (Gold)", group=GRP_VISUAL)
color aTierColor = input.color(color.new(#00E676, 0), "A-Tier (Green)", group=GRP_VISUAL)
color bTierColor = input.color(color.new(#FFC107, 0), "B-Tier (Yellow)", group=GRP_VISUAL)
color longColor = input.color(color.new(#00E676, 0), "Long", group=GRP_VISUAL)
color shortColor = input.color(color.new(#FF5252, 0), "Short", group=GRP_VISUAL)
color slColor = input.color(color.new(#FF5252, 30), "SL Line", group=GRP_VISUAL)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  OHLC STRUCTURE  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Candle anatomy
float bodyHigh = math.max(open, close)
float bodyLow = math.min(open, close)
float bodySize = bodyHigh - bodyLow
float upperWick = high - bodyHigh
float lowerWick = bodyLow - low
float candleRange = high - low

// Point calculation
float candlePoints = candleRange / tickValue / ticksPerPoint

// Candle direction
bool isBullish = close > open
bool isBearish = close < open

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  TIER CLASSIFICATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string tier = candlePoints >= sTierPoints ? "S" : candlePoints >= aTierPoints ? "A" : candlePoints >= bTierPoints ? "B" : "X"
bool isTiered = tier != "X"

bool isTierS = tier == "S"
bool isTierA = tier == "A"
bool isTierB = tier == "B"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  VOLUME ANALYSIS  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

float avgVol = ta.sma(volume, volMaLength)
float volRatio = avgVol > 0 ? volume / avgVol : 1.0
bool hasVolume = volRatio >= minVolRatio
bool strongVol = volRatio >= strongVolRatio

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  VOLUME DELTA ANALYSIS  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var float buyVol = 0.0
var float sellVol = 0.0

if timeframe.isintraday
    [ltfO, ltfC, ltfV, ltfH, ltfL] = request.security_lower_tf(syminfo.tickerid, analysisTimeframe, [open, close, volume, high, low])
    
    if array.size(ltfC) > 0
        float tBuy = 0.0
        float tSell = 0.0
        
        for i = 0 to array.size(ltfC) - 1
            float r = array.get(ltfH, i) - array.get(ltfL, i)
            float c = array.get(ltfC, i)
            float o = array.get(ltfO, i)
            float v = array.get(ltfV, i)
            
            if r > 0
                tBuy += ((c - array.get(ltfL, i)) / r) * v
                tSell += ((array.get(ltfH, i) - c) / r) * v
            else
                if c >= o
                    tBuy += v
                else
                    tSell += v
        
        buyVol := tBuy
        sellVol := tSell
    else
        buyVol := candleRange > 0 ? ((close - low) / candleRange) * volume : volume * 0.5
        sellVol := candleRange > 0 ? ((high - close) / candleRange) * volume : volume * 0.5
else
    buyVol := candleRange > 0 ? ((close - low) / candleRange) * volume : volume * 0.5
    sellVol := candleRange > 0 ? ((high - close) / candleRange) * volume : volume * 0.5

float totalVol = buyVol + sellVol
float buyPct = totalVol > 0 ? buyVol / totalVol : 0.5
float sellPct = totalVol > 0 ? sellVol / totalVol : 0.5

bool buyDominant = buyPct >= deltaThreshold
bool sellDominant = sellPct >= deltaThreshold

// Direction confirmation: candle + delta must agree
bool confirmedLong = isBullish and buyDominant
bool confirmedShort = isBearish and sellDominant

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  SESSION FILTER  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bool inLondon = not na(time(timeframe.period, londonWindow, sessionTimezone))
bool inNY = not na(time(timeframe.period, nyWindow, sessionTimezone))
bool inSession = inLondon or inNY
bool sessionOK = onlyKeySession ? inSession : true

// Session markers
bool londonStart = na(time(timeframe.period, londonWindow, sessionTimezone)[1]) and inLondon and timeframe.isintraday
bool nyStart = na(time(timeframe.period, nyWindow, sessionTimezone)[1]) and inNY and timeframe.isintraday

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  STOP LOSS CALCULATION (OHLC-BASED)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// SL Buffer in price
float buffer = slBufferTicks * tickValue

// LONG STOP LOSS - positioned based on candle structure and tier
// S-Tier: SL at candle low (widest - expecting big continuation)
// A-Tier: SL at midpoint between body low and candle low
// B-Tier: SL just below body low (tightest - quick scalp)

float longSL_S = low - buffer                                    // At wick low
float longSL_A = bodyLow - (lowerWick * 0.5) - buffer           // Midpoint of lower wick
float longSL_B = bodyLow - buffer                                // Just below body

// SHORT STOP LOSS - positioned based on candle structure and tier
// S-Tier: SL at candle high (widest)
// A-Tier: SL at midpoint between body high and candle high
// B-Tier: SL just above body high (tightest)

float shortSL_S = high + buffer                                  // At wick high
float shortSL_A = bodyHigh + (upperWick * 0.5) + buffer         // Midpoint of upper wick
float shortSL_B = bodyHigh + buffer                              // Just above body

// Select appropriate SL based on tier and direction
float longSL = isTierS ? longSL_S : isTierA ? longSL_A : longSL_B
float shortSL = isTierS ? shortSL_S : isTierA ? shortSL_A : shortSL_B

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  SIGNAL LOGIC  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// All conditions must be true for a signal
bool longSignal = isTiered and hasVolume and confirmedLong and sessionOK
bool shortSignal = isTiered and hasVolume and confirmedShort and sessionOK

// Tier-specific signals
bool sLong = longSignal and isTierS
bool aLong = longSignal and isTierA
bool bLong = longSignal and isTierB

bool sShort = shortSignal and isTierS
bool aShort = shortSignal and isTierA
bool bShort = shortSignal and isTierB

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  VISUALIZATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Tier color selection
color tierCol = isTierS ? sTierColor : isTierA ? aTierColor : isTierB ? bTierColor : na

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LONG SIGNALS (Below candle) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// S-Tier Long
plotshape(sLong, "S Long Arrow", shape.triangleup, location.belowbar, longColor, size=size.tiny)
plotshape(sLong, "S Long Badge", shape.square, location.belowbar, sTierColor, size=size.tiny, text="S", textcolor=color.black, offset=0)

// A-Tier Long
plotshape(aLong, "A Long Arrow", shape.triangleup, location.belowbar, longColor, size=size.tiny)
plotshape(aLong, "A Long Badge", shape.square, location.belowbar, aTierColor, size=size.tiny, text="A", textcolor=color.black, offset=0)

// B-Tier Long
plotshape(bLong, "B Long Arrow", shape.triangleup, location.belowbar, longColor, size=size.tiny)
plotshape(bLong, "B Long Badge", shape.square, location.belowbar, bTierColor, size=size.tiny, text="B", textcolor=color.black, offset=0)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SHORT SIGNALS (Above candle) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// S-Tier Short
plotshape(sShort, "S Short Arrow", shape.triangledown, location.abovebar, shortColor, size=size.tiny)
plotshape(sShort, "S Short Badge", shape.square, location.abovebar, sTierColor, size=size.tiny, text="S", textcolor=color.black, offset=0)

// A-Tier Short
plotshape(aShort, "A Short Arrow", shape.triangledown, location.abovebar, shortColor, size=size.tiny)
plotshape(aShort, "A Short Badge", shape.square, location.abovebar, aTierColor, size=size.tiny, text="A", textcolor=color.black, offset=0)

// B-Tier Short
plotshape(bShort, "B Short Arrow", shape.triangledown, location.abovebar, shortColor, size=size.tiny)
plotshape(bShort, "B Short Badge", shape.square, location.abovebar, bTierColor, size=size.tiny, text="B", textcolor=color.black, offset=0)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ STOP LOSS LINES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Long SL Lines - drawn AT the calculated SL level WITHIN candle structure
if showSL and longSignal
    line.new(bar_index, longSL, bar_index + slLineLength, longSL, color=slColor, width=2, style=line.style_solid)

// Short SL Lines
if showSL and shortSignal
    line.new(bar_index, shortSL, bar_index + slLineLength, shortSL, color=slColor, width=2, style=line.style_solid)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SESSION MARKERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
plotshape(londonStart, "LDN", shape.diamond, location.abovebar, color.new(#2196F3, 0), size=size.tiny, text="L", textcolor=color.white)
plotshape(nyStart, "NY", shape.diamond, location.abovebar, color.new(#4CAF50, 0), size=size.tiny, text="N", textcolor=color.white)

// Session background
bgcolor(inLondon ? color.new(#2196F3, 96) : na, title="London BG")
bgcolor(inNY ? color.new(#4CAF50, 96) : na, title="NY BG")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  INFO PANEL  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var table panel = table.new(position.top_right, 2, 8, bgcolor=color.new(color.black, 85), border_width=1, border_color=color.new(color.gray, 60))

if barstate.islast
    // Header
    table.cell(panel, 0, 0, "GRA", text_color=color.white, text_size=size.small, bgcolor=color.new(#FFD700, 70))
    table.cell(panel, 1, 0, instrumentType, text_color=color.white, text_size=size.small, bgcolor=color.new(#FFD700, 70))
    
    // Points
    table.cell(panel, 0, 1, "Pts", text_color=color.gray, text_size=size.tiny)
    table.cell(panel, 1, 1, str.tostring(candlePoints, "#.#"), text_color=tierCol, text_size=size.tiny)
    
    // Tier
    table.cell(panel, 0, 2, "Tier", text_color=color.gray, text_size=size.tiny)
    table.cell(panel, 1, 2, tier, text_color=tierCol, text_size=size.tiny)
    
    // Volume
    table.cell(panel, 0, 3, "Vol", text_color=color.gray, text_size=size.tiny)
    color vCol = strongVol ? color.yellow : hasVolume ? color.green : color.red
    table.cell(panel, 1, 3, str.tostring(volRatio, "#.#") + "x", text_color=vCol, text_size=size.tiny)
    
    // Delta
    string dStr = buyPct > sellPct ? str.tostring(buyPct * 100, "#") + "%B" : str.tostring(sellPct * 100, "#") + "%S"
    color dCol = buyDominant ? longColor : sellDominant ? shortColor : color.gray
    table.cell(panel, 0, 4, "Delta", text_color=color.gray, text_size=size.tiny)
    table.cell(panel, 1, 4, dStr, text_color=dCol, text_size=size.tiny)
    
    // Direction
    string dirStr = confirmedLong ? "LONG" : confirmedShort ? "SHORT" : "---"
    color dirCol = confirmedLong ? longColor : confirmedShort ? shortColor : color.gray
    table.cell(panel, 0, 5, "Dir", text_color=color.gray, text_size=size.tiny)
    table.cell(panel, 1, 5, dirStr, text_color=dirCol, text_size=size.tiny)
    
    // Session
    string sStr = inNY ? "NY!" : inLondon ? "LDN!" : "---"
    table.cell(panel, 0, 6, "Sess", text_color=color.gray, text_size=size.tiny)
    table.cell(panel, 1, 6, sStr, text_color=inSession ? color.yellow : color.gray, text_size=size.tiny)
    
    // Signal + SL
    string sigStr = sLong ? "Sâ–²" : aLong ? "Aâ–²" : bLong ? "Bâ–²" : sShort ? "Sâ–¼" : aShort ? "Aâ–¼" : bShort ? "Bâ–¼" : "---"
    color sigCol = longSignal ? longColor : shortSignal ? shortColor : color.gray
    table.cell(panel, 0, 7, "Sig", text_color=color.gray, text_size=size.tiny)
    table.cell(panel, 1, 7, sigStr, text_color=sigCol, text_size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  ALERTS  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alertcondition(sLong, title="S-TIER LONG", message="ğŸ¥‡ S-TIER LONG {{ticker}} @ {{close}} | SL: WICK LOW | HOLD LONGER")
alertcondition(aLong, title="A-TIER LONG", message="ğŸ¥ˆ A-TIER LONG {{ticker}} @ {{close}} | SL: MID WICK | HOLD A BIT")
alertcondition(bLong, title="B-TIER LONG", message="ğŸ¥‰ B-TIER LONG {{ticker}} @ {{close}} | SL: BODY LOW | CLOSE QUICK")

alertcondition(sShort, title="S-TIER SHORT", message="ğŸ¥‡ S-TIER SHORT {{ticker}} @ {{close}} | SL: WICK HIGH | HOLD LONGER")
alertcondition(aShort, title="A-TIER SHORT", message="ğŸ¥ˆ A-TIER SHORT {{ticker}} @ {{close}} | SL: MID WICK | HOLD A BIT")
alertcondition(bShort, title="B-TIER SHORT", message="ğŸ¥‰ B-TIER SHORT {{ticker}} @ {{close}} | SL: BODY HIGH | CLOSE QUICK")

alertcondition(londonStart, title="LONDON OPEN", message="London Open - {{ticker}}")
alertcondition(nyStart, title="NY OPEN", message="NY Open - {{ticker}}")

// Dynamic alert with SL price
if longSignal or shortSignal
    string t = tier
    string d = longSignal ? "LONG" : "SHORT"
    float sl = longSignal ? longSL : shortSL
    string act = isTierS ? "HOLD LONGER" : isTierA ? "HOLD A BIT" : "CLOSE QUICK"
    alert("GRA " + t + "-" + d + " | " + syminfo.ticker + " @ " + str.tostring(close, format.mintick) + " | SL: " + str.tostring(sl, format.mintick) + " | " + act, alert.freq_once_per_bar_close)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  END OF INDICATOR  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
