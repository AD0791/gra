// This Pine Scriptâ„¢ code is subject to the terms of the Mozilla Public License 2.0
// Â© Alexandro Disla - YM Ultimate SNIPER
// Unified GRA + DeepFlow | YM-Optimized for Low Volatility
// TARGET: 3-7 High-Confluence Trades per Day

//@version=6
indicator("YM Ultimate SNIPER", shorttitle="YMğŸ¯", overlay=true, 
     max_labels_count=500, max_boxes_count=500, max_lines_count=500)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  YM-SPECIFIC CONSTANTS  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// YM: 1 tick = 1 point = $5 per contract
// Typical daily range: 150-400 points
// Lower volatility than NQ (30-40% less)
// Strategy: Exploit predictability with tighter filters

var float TICK_VALUE = 1.0
var float TICKS_PER_POINT = 1.0

// YM Average Daily Ranges (for context)
// Low vol day: ~150 pts | Normal: ~250 pts | High vol: ~400 pts
// This means S-Tier moves (50+ pts) are ~20% of normal daily range

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  CONFIGURATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string GRP_YM = "â•â•â•â•â•â•â•â•â•â•â• YM TIER THRESHOLDS â•â•â•â•â•â•â•â•â•â•â•"
float sTierPoints = input.float(50.0, "S-Tier (Points)", minval=20, maxval=150, step=5, group=GRP_YM,
     tooltip="50+ pts = ~$250/contract HOLD (institutional sweep)")
float aTierPoints = input.float(25.0, "A-Tier (Points)", minval=10, maxval=75, step=5, group=GRP_YM,
     tooltip="25-49 pts = ~$125-250/contract SWING (strong momentum)")
float bTierPoints = input.float(12.0, "B-Tier (Points)", minval=5, maxval=30, step=1, group=GRP_YM,
     tooltip="12-24 pts = ~$60-120/contract SCALP (quick grab)")

string GRP_SNIPER = "â•â•â•â•â•â•â•â•â•â•â• SNIPER FILTERS (YM-TUNED) â•â•â•â•â•â•â•â•â•â•â•"
float minVolRatio = input.float(1.8, "Min Volume Ratio", minval=1.3, maxval=3.0, step=0.1, group=GRP_SNIPER,
     tooltip="YM needs 1.8x volume (higher than NQ due to lower retail noise)")
float deltaThreshold = input.float(0.62, "Delta Dominance %", minval=0.55, maxval=0.80, step=0.01, group=GRP_SNIPER,
     tooltip="62%+ = Clear institutional commitment in YM")
float bodyRatio = input.float(0.72, "Min Body Ratio", minval=0.5, maxval=0.9, step=0.02, group=GRP_SNIPER,
     tooltip="72%+ body = Strong conviction (tighter for YM)")
float rangeMultiplier = input.float(1.4, "Min Range vs Avg", minval=1.0, maxval=2.5, step=0.1, group=GRP_SNIPER,
     tooltip="1.4x range = Above-average move in YM")
bool requireCVDConfirm = input.bool(true, "Require CVD Confirmation", group=GRP_SNIPER)
string analysisTimeframe = input.timeframe("1", "Intrabar TF", group=GRP_SNIPER)

string GRP_SESSION = "â•â•â•â•â•â•â•â•â•â•â• SESSION WINDOWS â•â•â•â•â•â•â•â•â•â•â•"
bool onlyKeySession = input.bool(true, "Only Signal in Key Sessions", group=GRP_SESSION)
string sessionTimezone = input.string("America/New_York", "Timezone", 
     options=["America/New_York", "America/Chicago", "Europe/London", "UTC"], group=GRP_SESSION)
string londonWindow = input.string("0300-0500", "London Window", group=GRP_SESSION,
     tooltip="3:00-5:00 AM ET - European institutional flow")
string nyWindow = input.string("0930-1130", "NY Open Window", group=GRP_SESSION,
     tooltip="9:30-11:30 AM ET - US institutional flow")
string nyPowerHour = input.string("1500-1600", "NY Power Hour", group=GRP_SESSION,
     tooltip="3:00-4:00 PM ET - End-of-day institutional rebalancing")
bool includePowerHour = input.bool(true, "Include Power Hour", group=GRP_SESSION,
     tooltip="Include 3-4 PM ET for additional opportunities")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  DEEPFLOW ZONE CONFIGURATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string GRP_ZONES = "â•â•â•â•â•â•â•â•â•â•â• DEEPFLOW ZONES (YM-TUNED) â•â•â•â•â•â•â•â•â•â•â•"
bool showZones = input.bool(true, "Show Limit Order Zones", group=GRP_ZONES)
bool showSinglePrints = input.bool(true, "Show Single Print Lines", group=GRP_ZONES)
float minGapATR = input.float(0.25, "Min Gap Size (ATR%)", minval=0.1, maxval=0.8, step=0.05, group=GRP_ZONES,
     tooltip="25% ATR gap = Significant for YM (lower than NQ)")
float zoneImpulseMultiplier = input.float(1.6, "Zone Impulse Multiplier", minval=1.3, maxval=2.5, step=0.1, group=GRP_ZONES,
     tooltip="1.6x average range (tuned for YM's steadier moves)")
int maxZoneAge = input.int(75, "Max Zone Age (bars)", minval=30, maxval=150, group=GRP_ZONES,
     tooltip="YM zones stay valid longer (less volatile)")
int maxZones = input.int(12, "Max Active Zones", minval=5, maxval=25, group=GRP_ZONES)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  POC & IMBALANCE CONFIGURATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string GRP_POC = "â•â•â•â•â•â•â•â•â•â•â• POC SETTINGS â•â•â•â•â•â•â•â•â•â•â•"
bool showPOC = input.bool(true, "Show POC", group=GRP_POC)
bool pocOnlyTiered = input.bool(true, "POC Only on Tiered Candles", group=GRP_POC)
int pocResolution = input.int(12, "POC Price Bins", minval=5, maxval=25, step=1, group=GRP_POC,
     tooltip="12 bins optimal for YM tick structure")
int pocLookback = input.int(60, "POC Display Count", minval=20, maxval=150, group=GRP_POC)

string GRP_IMB = "â•â•â•â•â•â•â•â•â•â•â• IMBALANCE SETTINGS â•â•â•â•â•â•â•â•â•â•â•"
bool showImbalances = input.bool(true, "Show Imbalances", group=GRP_IMB)
float imbRatio = input.float(2.3, "Min Imbalance Ratio", minval=1.5, maxval=4.0, step=0.1, group=GRP_IMB,
     tooltip="2.3x ratio for YM (slightly lower due to larger tick value)")
int minStackedLevels = input.int(2, "Min Stacked Levels", minval=1, maxval=5, group=GRP_IMB)
bool imbOnlySession = input.bool(true, "Imbalances Only in Sessions", group=GRP_IMB)
float imbVolFilter = input.float(1.4, "Min Volume for Imbalance", minval=1.0, maxval=2.5, step=0.1, group=GRP_IMB)
int imbLookback = input.int(40, "Imbalance Display Count", minval=10, maxval=100, group=GRP_IMB)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  CONFLUENCE SCORING SYSTEM  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string GRP_CONFLUENCE = "â•â•â•â•â•â•â•â•â•â•â• CONFLUENCE SCORING â•â•â•â•â•â•â•â•â•â•â•"
int minConfluenceScore = input.int(5, "Min Confluence Score", minval=3, maxval=8, group=GRP_CONFLUENCE,
     tooltip="Minimum score to show signal (max possible: 10)")
bool showAllScores = input.bool(false, "Show All Scores (Debug)", group=GRP_CONFLUENCE)

// Confluence Point Values:
// - Tier Signal: S=3, A=2, B=1
// - In Active Zone: +2
// - POC Alignment: +1
// - Imbalance Support: +1
// - Strong Volume (2x+): +1
// - Strong Delta (70%+): +1
// - CVD Momentum: +1

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  COLOR CONFIGURATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string GRP_COLORS = "â•â•â•â•â•â•â•â•â•â•â• COLORS â•â•â•â•â•â•â•â•â•â•â•"
color sTierColor = input.color(color.new(#FFD700, 0), "S-Tier (Gold)", group=GRP_COLORS)
color aTierColor = input.color(color.new(#00E676, 0), "A-Tier (Green)", group=GRP_COLORS)
color bTierColor = input.color(color.new(#FFC107, 0), "B-Tier (Yellow)", group=GRP_COLORS)
color bullZoneColor = input.color(color.new(#00E676, 75), "Bullish Zone", group=GRP_COLORS)
color bearZoneColor = input.color(color.new(#FF5252, 75), "Bearish Zone", group=GRP_COLORS)
color pocColor = input.color(color.new(#FFD700, 0), "POC (Gold)", group=GRP_COLORS)
color singlePrintColor = input.color(color.new(#9C27B0, 20), "Single Print (Purple)", group=GRP_COLORS)
color bullImbColor = input.color(color.new(#00E676, 60), "Bull Imbalance", group=GRP_COLORS)
color bearImbColor = input.color(color.new(#FF5252, 60), "Bear Imbalance", group=GRP_COLORS)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  CANDLE STRUCTURE  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

float bodyHigh = math.max(open, close)
float bodyLow = math.min(open, close)
float bodySize = bodyHigh - bodyLow
float candleRange = high - low
float upperWick = high - bodyHigh
float lowerWick = bodyLow - low

float candlePoints = candleRange / TICK_VALUE / TICKS_PER_POINT

bool isBullish = close > open
bool isBearish = close < open

float avgRange = ta.sma(candleRange, 20)
float avgVol = ta.sma(volume, 20)
float volRatio = avgVol > 0 ? volume / avgVol : 1.0
float atr = ta.atr(14)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  SNIPER QUALITY FILTERS  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

float currentBodyRatio = candleRange > 0 ? bodySize / candleRange : 0
bool hasStrongBody = currentBodyRatio >= bodyRatio
bool hasSignificantRange = candleRange >= avgRange * rangeMultiplier
bool hasVolume = volRatio >= minVolRatio
bool hasStrongVolume = volRatio >= 2.0  // Bonus for strong volume

bool bullWickOK = isBullish ? (upperWick < bodySize * 0.5) : true
bool bearWickOK = isBearish ? (lowerWick < bodySize * 0.5) : true
bool wicksOK = bullWickOK and bearWickOK

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  TIER CLASSIFICATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string tier = candlePoints >= sTierPoints ? "S" : candlePoints >= aTierPoints ? "A" : candlePoints >= bTierPoints ? "B" : "X"
bool isTiered = tier != "X"
bool isTierS = tier == "S"
bool isTierA = tier == "A"
bool isTierB = tier == "B"

int tierScore = isTierS ? 3 : isTierA ? 2 : isTierB ? 1 : 0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  SESSION DETECTION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bool inLondon = not na(time(timeframe.period, londonWindow, sessionTimezone))
bool inNY = not na(time(timeframe.period, nyWindow, sessionTimezone))
bool inPowerHour = includePowerHour ? not na(time(timeframe.period, nyPowerHour, sessionTimezone)) : false
bool inSession = inLondon or inNY or inPowerHour
bool sessionOK = onlyKeySession ? inSession : true

bool londonStart = na(time(timeframe.period, londonWindow, sessionTimezone)[1]) and inLondon and timeframe.isintraday
bool nyStart = na(time(timeframe.period, nyWindow, sessionTimezone)[1]) and inNY and timeframe.isintraday
bool powerHourStart = includePowerHour and na(time(timeframe.period, nyPowerHour, sessionTimezone)[1]) and inPowerHour and timeframe.isintraday

// Current session label
string currentSession = inNY ? "NY!" : inLondon ? "LDN!" : inPowerHour ? "PWR!" : "---"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  INTRABAR ANALYSIS - DELTA, POC & IMBALANCES  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type VolumeProfile
    array<float> priceLevels
    array<float> buyVolumes
    array<float> sellVolumes

type Imbalance
    float priceTop
    float priceBottom
    bool isBullish
    int barIdx

type DFZone
    float priceTop
    float priceBottom
    bool isBullish
    int barIdx
    int state  // 0=fresh, 1=tested, 2=broken

var float buyVol = 0.0
var float sellVol = 0.0
var float cvd = 0.0
var float currentPOC = na
var array<Imbalance> imbalances = array.new<Imbalance>()

// Arrays for visualization
var array<line> pocLines = array.new<line>()
var array<box> imbBoxes = array.new<box>()

// DeepFlow Zone Storage
var array<box> zoneBoxes = array.new<box>()
var array<line> zoneLines = array.new<line>()  // CE lines
var array<DFZone> zones = array.new<DFZone>()

// Single Print Storage
var array<line> spHighLines = array.new<line>()
var array<line> spLowLines = array.new<line>()
var array<int> spBars = array.new<int>()
var array<bool> spBull = array.new<bool>()

if timeframe.isintraday
    [ltfO, ltfC, ltfV, ltfH, ltfL] = request.security_lower_tf(syminfo.tickerid, analysisTimeframe, [open, close, volume, high, low])
    
    if array.size(ltfC) > 0
        float tBuy = 0.0
        float tSell = 0.0
        
        // Create price bins for volume profile
        float priceStep = candleRange / pocResolution
        array<float> binVolumes = array.new_float(pocResolution, 0.0)
        array<float> binBuyVol = array.new_float(pocResolution, 0.0)
        array<float> binSellVol = array.new_float(pocResolution, 0.0)
        
        // Process each intrabar candle
        for i = 0 to array.size(ltfC) - 1
            float ltfRange = array.get(ltfH, i) - array.get(ltfL, i)
            float ltfClose = array.get(ltfC, i)
            float ltfOpen = array.get(ltfO, i)
            float ltfVol = array.get(ltfV, i)
            float ltfLow = array.get(ltfL, i)
            
            float buyPctCalc = 0.5
            if ltfRange > 0
                buyPctCalc := (ltfClose - ltfLow) / ltfRange
            else
                buyPctCalc := ltfClose >= ltfOpen ? 1.0 : 0.0
            
            float barBuy = buyPctCalc * ltfVol
            float barSell = (1 - buyPctCalc) * ltfVol
            
            tBuy += barBuy
            tSell += barSell
            
            // Assign volume to price bins
            float ltfVWAP = (array.get(ltfH, i) + array.get(ltfL, i) + ltfClose) / 3
            int binIdx = priceStep > 0 ? math.floor((ltfVWAP - low) / priceStep) : 0
            binIdx := math.max(0, math.min(binIdx, pocResolution - 1))
            
            array.set(binVolumes, binIdx, array.get(binVolumes, binIdx) + ltfVol)
            array.set(binBuyVol, binIdx, array.get(binBuyVol, binIdx) + barBuy)
            array.set(binSellVol, binIdx, array.get(binSellVol, binIdx) + barSell)
        
        buyVol := tBuy
        sellVol := tSell
        
        // Find POC (highest volume bin)
        float maxVol = 0.0
        int pocBinIdx = 0
        for j = 0 to pocResolution - 1
            if array.get(binVolumes, j) > maxVol
                maxVol := array.get(binVolumes, j)
                pocBinIdx := j
        
        currentPOC := low + (pocBinIdx + 0.5) * priceStep
        
        // Detect Imbalances
        int bullStackCount = 0
        int bearStackCount = 0
        int bullStackStart = -1
        int bearStackStart = -1
        int bullStackEnd = -1
        int bearStackEnd = -1
        
        for k = 0 to pocResolution - 1
            float binBuy = array.get(binBuyVol, k)
            float binSell = array.get(binSellVol, k)
            
            bool isBullImb = binSell > 0 ? (binBuy / binSell >= imbRatio) : binBuy > 0
            bool isBearImb = binBuy > 0 ? (binSell / binBuy >= imbRatio) : binSell > 0
            
            // Track bullish stacks
            if isBullImb
                if bullStackCount == 0
                    bullStackStart := k
                bullStackCount += 1
                bullStackEnd := k
            else
                if bullStackCount >= minStackedLevels
                    Imbalance newImb = Imbalance.new()
                    newImb.priceBottom := low + bullStackStart * priceStep
                    newImb.priceTop := low + (bullStackEnd + 1) * priceStep
                    newImb.isBullish := true
                    newImb.barIdx := bar_index
                    array.push(imbalances, newImb)
                bullStackCount := 0
                bullStackStart := -1
            
            // Track bearish stacks
            if isBearImb
                if bearStackCount == 0
                    bearStackStart := k
                bearStackCount += 1
                bearStackEnd := k
            else
                if bearStackCount >= minStackedLevels
                    Imbalance newImb = Imbalance.new()
                    newImb.priceBottom := low + bearStackStart * priceStep
                    newImb.priceTop := low + (bearStackEnd + 1) * priceStep
                    newImb.isBullish := false
                    newImb.barIdx := bar_index
                    array.push(imbalances, newImb)
                bearStackCount := 0
                bearStackStart := -1
        
        // Handle stacks at end
        if bullStackCount >= minStackedLevels
            Imbalance newImb = Imbalance.new()
            newImb.priceBottom := low + bullStackStart * priceStep
            newImb.priceTop := low + (bullStackEnd + 1) * priceStep
            newImb.isBullish := true
            newImb.barIdx := bar_index
            array.push(imbalances, newImb)
        
        if bearStackCount >= minStackedLevels
            Imbalance newImb = Imbalance.new()
            newImb.priceBottom := low + bearStackStart * priceStep
            newImb.priceTop := low + (bearStackEnd + 1) * priceStep
            newImb.isBullish := false
            newImb.barIdx := bar_index
            array.push(imbalances, newImb)

else
    // Fallback for non-intraday
    float rng = high - low
    if rng > 0
        float buyPctEst = (close - low) / rng
        buyVol := buyPctEst * volume
        sellVol := (1 - buyPctEst) * volume
    else
        if close >= open
            buyVol := volume
            sellVol := 0
        else
            sellVol := volume
            buyVol := 0
    currentPOC := (high + low + close) / 3

// Update CVD
float barDelta = buyVol - sellVol
cvd := cvd + barDelta

float totalVol = buyVol + sellVol
float buyPct = totalVol > 0 ? buyVol / totalVol : 0.5
float sellPct = totalVol > 0 ? sellVol / totalVol : 0.5

bool buyDominant = buyPct >= deltaThreshold
bool sellDominant = sellPct >= deltaThreshold
bool strongDelta = buyPct >= 0.70 or sellPct >= 0.70

// CVD trend confirmation
float cvdMA = ta.sma(cvd, 5)
bool cvdBullish = cvd > cvdMA
bool cvdBearish = cvd < cvdMA

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  DEEPFLOW FVG ZONE DETECTION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// FVG = Fair Value Gap
bool fvgBullRaw = low > high[2]
bool fvgBearRaw = high < low[2]

float bullGapSize = fvgBullRaw ? (low - high[2]) : 0
float bearGapSize = fvgBearRaw ? (low[2] - high) : 0

// SNIPER Zone Requirements (YM-Tuned)
bool gapSizeOK_Bull = bullGapSize >= atr * minGapATR
bool gapSizeOK_Bear = bearGapSize >= atr * minGapATR

bool impulseOK_Bull = candleRange[1] > avgRange * zoneImpulseMultiplier and 
                      (math.abs(close[1] - open[1]) / (high[1] - low[1])) >= bodyRatio
bool impulseOK_Bear = candleRange[1] > avgRange * zoneImpulseMultiplier and 
                      (math.abs(close[1] - open[1]) / (high[1] - low[1])) >= bodyRatio

bool zoneVolumeOK = volume[1] >= avgVol * minVolRatio
bool deltaOK_Bull = isBullish[1]
bool deltaOK_Bear = isBearish[1]

bool validBullZone = fvgBullRaw and gapSizeOK_Bull and impulseOK_Bull and zoneVolumeOK and deltaOK_Bull and sessionOK
bool validBearZone = fvgBearRaw and gapSizeOK_Bear and impulseOK_Bear and zoneVolumeOK and deltaOK_Bear and sessionOK

// Single Print Detection (Institutional Impulse)
bool isSniperImpulse = (candleRange > avgRange * zoneImpulseMultiplier) and 
                        (currentBodyRatio >= bodyRatio) and 
                        (volRatio >= minVolRatio)
bool sniperSinglePrint = isSniperImpulse and ((isBullish and buyDominant) or (isBearish and sellDominant)) and sessionOK

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  CREATE NEW ZONES  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if showZones and barstate.isconfirmed
    if validBullZone
        float topPrice = low
        float bottomPrice = high[2]
        float entry = (topPrice + bottomPrice) / 2
        
        box zoneBox = box.new(bar_index[2], topPrice, bar_index + 500, bottomPrice,
             border_color=color.new(#00E676, 40), bgcolor=bullZoneColor, border_width=2)
        line entryLine = line.new(bar_index[2], entry, bar_index + 500, entry,
             color=color.new(#FFFFFF, 40), style=line.style_dotted, width=1)
        
        DFZone newZone = DFZone.new()
        newZone.priceTop := topPrice
        newZone.priceBottom := bottomPrice
        newZone.isBullish := true
        newZone.barIdx := bar_index
        newZone.state := 0
        
        array.push(zoneBoxes, zoneBox)
        array.push(zoneLines, entryLine)
        array.push(zones, newZone)
    
    if validBearZone
        float topPrice = low[2]
        float bottomPrice = high
        float entry = (topPrice + bottomPrice) / 2
        
        box zoneBox = box.new(bar_index[2], topPrice, bar_index + 500, bottomPrice,
             border_color=color.new(#FF5252, 40), bgcolor=bearZoneColor, border_width=2)
        line entryLine = line.new(bar_index[2], entry, bar_index + 500, entry,
             color=color.new(#FFFFFF, 40), style=line.style_dotted, width=1)
        
        DFZone newZone = DFZone.new()
        newZone.priceTop := topPrice
        newZone.priceBottom := bottomPrice
        newZone.isBullish := false
        newZone.barIdx := bar_index
        newZone.state := 0
        
        array.push(zoneBoxes, zoneBox)
        array.push(zoneLines, entryLine)
        array.push(zones, newZone)

// Single Print Lines
if showSinglePrints and sniperSinglePrint and barstate.isconfirmed
    line highLine = line.new(bar_index, high, bar_index + 500, high,
         color=singlePrintColor, style=line.style_solid, width=2)
    line lowLine = line.new(bar_index, low, bar_index + 500, low,
         color=singlePrintColor, style=line.style_solid, width=2)
    
    array.push(spHighLines, highLine)
    array.push(spLowLines, lowLine)
    array.push(spBars, bar_index)
    array.push(spBull, isBullish)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  ZONE STATE MANAGEMENT  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var bool atBullZone = false
var bool atBearZone = false
var int activeBullZones = 0
var int activeBearZones = 0

atBullZone := false
atBearZone := false
activeBullZones := 0
activeBearZones := 0

if array.size(zones) > 0
    for i = array.size(zones) - 1 to 0
        if i >= array.size(zones)
            continue
            
        DFZone zone = array.get(zones, i)
        int age = bar_index - zone.barIdx
        
        // Delete old zones
        if age > maxZoneAge or zone.state >= 2
            if i < array.size(zoneBoxes)
                box.delete(array.get(zoneBoxes, i))
                array.remove(zoneBoxes, i)
            if i < array.size(zoneLines)
                line.delete(array.get(zoneLines, i))
                array.remove(zoneLines, i)
            array.remove(zones, i)
            continue
        
        // Count and check active zones
        if zone.state < 2
            if zone.isBullish
                activeBullZones += 1
                if close >= zone.priceBottom and close <= zone.priceTop
                    atBullZone := true
            else
                activeBearZones += 1
                if close >= zone.priceBottom and close <= zone.priceTop
                    atBearZone := true
        
        // Update zone state
        if zone.isBullish
            if zone.state == 0 and low <= (zone.priceTop + zone.priceBottom) / 2
                zone.state := 1
                if i < array.size(zoneBoxes)
                    box.set_bgcolor(array.get(zoneBoxes, i), color.new(#78909C, 80))
            if zone.state < 2 and close < zone.priceBottom
                zone.state := 2
                if i < array.size(zoneBoxes)
                    box.set_bgcolor(array.get(zoneBoxes, i), color.new(color.gray, 90))
        else
            if zone.state == 0 and high >= (zone.priceTop + zone.priceBottom) / 2
                zone.state := 1
                if i < array.size(zoneBoxes)
                    box.set_bgcolor(array.get(zoneBoxes, i), color.new(#78909C, 80))
            if zone.state < 2 and close > zone.priceTop
                zone.state := 2
                if i < array.size(zoneBoxes)
                    box.set_bgcolor(array.get(zoneBoxes, i), color.new(color.gray, 90))

// Garbage collection
while array.size(zones) > maxZones
    if array.size(zoneBoxes) > 0
        box.delete(array.get(zoneBoxes, 0))
        array.remove(zoneBoxes, 0)
    if array.size(zoneLines) > 0
        line.delete(array.get(zoneLines, 0))
        array.remove(zoneLines, 0)
    if array.size(zones) > 0
        array.remove(zones, 0)

// Single print cleanup
if array.size(spBars) > 0
    for i = array.size(spBars) - 1 to 0
        int age = bar_index - array.get(spBars, i)
        if age > maxZoneAge
            if i < array.size(spHighLines)
                line.delete(array.get(spHighLines, i))
                array.remove(spHighLines, i)
            if i < array.size(spLowLines)
                line.delete(array.get(spLowLines, i))
                array.remove(spLowLines, i)
            if i < array.size(spBars)
                array.remove(spBars, i)
            if i < array.size(spBull)
                array.remove(spBull, i)

while array.size(spBars) > maxZones
    if array.size(spHighLines) > 0
        line.delete(array.get(spHighLines, 0))
        array.remove(spHighLines, 0)
    if array.size(spLowLines) > 0
        line.delete(array.get(spLowLines, 0))
        array.remove(spLowLines, 0)
    if array.size(spBars) > 0
        array.remove(spBars, 0)
    if array.size(spBull) > 0
        array.remove(spBull, 0)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  POC POSITION ANALYSIS  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// POC alignment scoring
// POC near body extreme = strong conviction
float pocPosition = candleRange > 0 ? (currentPOC - low) / candleRange : 0.5
bool pocAlignedLong = isBullish and pocPosition < 0.35  // POC in bottom 35% for longs
bool pocAlignedShort = isBearish and pocPosition > 0.65  // POC in top 35% for shorts

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  IMBALANCE SUPPORT CHECK  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Check if there's supporting imbalance
bool hasBullImbSupport = false
bool hasBearImbSupport = false

if array.size(imbalances) > 0
    for i = 0 to math.min(array.size(imbalances) - 1, 20)
        Imbalance imb = array.get(imbalances, i)
        if bar_index - imb.barIdx <= 15  // Recent imbalance
            if imb.isBullish and imb.priceTop <= close and imb.priceTop >= close - atr
                hasBullImbSupport := true
            if not imb.isBullish and imb.priceBottom >= close and imb.priceBottom <= close + atr
                hasBearImbSupport := true

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  CONFLUENCE SCORING & SIGNAL GENERATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bool confirmedLong = isBullish and buyDominant
bool confirmedShort = isBearish and sellDominant

bool cvdConfirmLong = not requireCVDConfirm or cvdBullish
bool cvdConfirmShort = not requireCVDConfirm or cvdBearish

// Base signal requirements (same as original SNIPER)
bool baseLong = isTiered and hasVolume and confirmedLong and hasStrongBody and hasSignificantRange and wicksOK and cvdConfirmLong and sessionOK
bool baseShort = isTiered and hasVolume and confirmedShort and hasStrongBody and hasSignificantRange and wicksOK and cvdConfirmShort and sessionOK

// Calculate confluence scores
int longConfluence = 0
int shortConfluence = 0

if baseLong
    longConfluence := tierScore                           // S=3, A=2, B=1
    longConfluence += atBullZone ? 2 : 0                  // In active zone
    longConfluence += pocAlignedLong ? 1 : 0             // POC alignment
    longConfluence += hasBullImbSupport ? 1 : 0          // Imbalance support
    longConfluence += hasStrongVolume ? 1 : 0            // 2x+ volume
    longConfluence += strongDelta and buyPct >= 0.70 ? 1 : 0  // 70%+ delta
    longConfluence += cvdBullish ? 1 : 0                 // CVD momentum

if baseShort
    shortConfluence := tierScore
    shortConfluence += atBearZone ? 2 : 0
    shortConfluence += pocAlignedShort ? 1 : 0
    shortConfluence += hasBearImbSupport ? 1 : 0
    shortConfluence += hasStrongVolume ? 1 : 0
    shortConfluence += strongDelta and sellPct >= 0.70 ? 1 : 0
    shortConfluence += cvdBearish ? 1 : 0

// Final SNIPER signals with confluence filter
bool longSignal = baseLong and longConfluence >= minConfluenceScore
bool shortSignal = baseShort and shortConfluence >= minConfluenceScore

// Tier-specific signals
bool sLong = longSignal and isTierS
bool aLong = longSignal and isTierA
bool bLong = longSignal and isTierB

bool sShort = shortSignal and isTierS
bool aShort = shortSignal and isTierA
bool bShort = shortSignal and isTierB

// Zone entry signals (DeepFlow style)
bool dfzBuyEntry = atBullZone and buyDominant and volRatio >= 1.5 and sessionOK
bool dfzSellEntry = atBearZone and sellDominant and volRatio >= 1.5 and sessionOK

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  STOP LOSS CALCULATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Dynamic stop based on POC and candle structure
float longStop = na
float shortStop = na
float longTarget = na
float shortTarget = na

if longSignal
    // Stop below POC or candle low (whichever is lower)
    longStop := math.min(currentPOC - TICK_VALUE, low) - TICK_VALUE
    // Target based on tier
    float riskPts = close - longStop
    float rewardMult = isTierS ? 2.5 : isTierA ? 2.0 : 1.5
    longTarget := close + (riskPts * rewardMult)

if shortSignal
    // Stop above POC or candle high (whichever is higher)
    shortStop := math.max(currentPOC + TICK_VALUE, high) + TICK_VALUE
    // Target based on tier
    float riskPts = shortStop - close
    float rewardMult = isTierS ? 2.5 : isTierA ? 2.0 : 1.5
    shortTarget := close - (riskPts * rewardMult)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  POC VISUALIZATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bool showPOCThisBar = showPOC
if pocOnlyTiered
    showPOCThisBar := showPOCThisBar and isTiered

if showPOCThisBar and not na(currentPOC) and barstate.isconfirmed
    line pocLine = line.new(bar_index, currentPOC, bar_index + 1, currentPOC,
         color=pocColor, width=3, style=line.style_solid)
    array.push(pocLines, pocLine)
    
    if array.size(pocLines) > pocLookback
        line oldLine = array.shift(pocLines)
        line.delete(oldLine)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  IMBALANCE VISUALIZATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bool imbVolOK = volRatio >= imbVolFilter
bool imbSessionOK = imbOnlySession ? inSession : true

if showImbalances and imbVolOK and imbSessionOK and barstate.isconfirmed
    int imbSize = array.size(imbalances)
    if imbSize > 0
        for idx = 0 to math.min(imbSize - 1, 10)
            if idx < array.size(imbalances)
                Imbalance imb = array.get(imbalances, idx)
                if imb.barIdx == bar_index
                    color imbCol = imb.isBullish ? bullImbColor : bearImbColor
                    box imbBox = box.new(bar_index - 1, imb.priceTop, bar_index + 2, imb.priceBottom,
                         bgcolor=imbCol, border_color=color.new(imbCol, -20), border_width=1)
                    array.push(imbBoxes, imbBox)

if array.size(imbBoxes) > imbLookback
    box oldBox = array.shift(imbBoxes)
    box.delete(oldBox)

if array.size(imbalances) > 200
    array.shift(imbalances)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  VISUALIZATION  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// GRA Tier Signals
plotshape(sLong, "S Long", shape.triangleup, location.belowbar, sTierColor, size=size.normal, text="SğŸ¯", textcolor=color.white)
plotshape(aLong, "A Long", shape.triangleup, location.belowbar, aTierColor, size=size.small, text="AğŸ¯", textcolor=color.white)
plotshape(bLong, "B Long", shape.triangleup, location.belowbar, bTierColor, size=size.tiny, text="BğŸ¯", textcolor=color.white)

plotshape(sShort, "S Short", shape.triangledown, location.abovebar, sTierColor, size=size.normal, text="SğŸ¯", textcolor=color.white)
plotshape(aShort, "A Short", shape.triangledown, location.abovebar, aTierColor, size=size.small, text="AğŸ¯", textcolor=color.white)
plotshape(bShort, "B Short", shape.triangledown, location.abovebar, bTierColor, size=size.tiny, text="BğŸ¯", textcolor=color.white)

// DeepFlow Zone Entry Signals (only when NOT already showing tier signal)
bool showDFZBuy = dfzBuyEntry and not longSignal
bool showDFZSell = dfzSellEntry and not shortSignal
plotshape(showDFZBuy, "DFZ Buy", shape.labelup, location.belowbar, color.new(#00E676, 0), text="ZğŸ¯", textcolor=color.white, size=size.tiny)
plotshape(showDFZSell, "DFZ Sell", shape.labeldown, location.abovebar, color.new(#FF5252, 0), text="ZğŸ¯", textcolor=color.white, size=size.tiny)

// Single Print markers
plotshape(sniperSinglePrint and isBullish, "SP Bull", shape.diamond, location.belowbar, singlePrintColor, size=size.tiny, text="SP", textcolor=color.white)
plotshape(sniperSinglePrint and isBearish, "SP Bear", shape.diamond, location.abovebar, singlePrintColor, size=size.tiny, text="SP", textcolor=color.white)

// Session Markers
plotshape(londonStart, "LDN", shape.diamond, location.abovebar, color.new(#2196F3, 0), size=size.tiny, text="LDN", textcolor=color.white)
plotshape(nyStart, "NY", shape.diamond, location.abovebar, color.new(#4CAF50, 0), size=size.tiny, text="NY", textcolor=color.white)
plotshape(powerHourStart, "PWR", shape.diamond, location.abovebar, color.new(#FF9800, 0), size=size.tiny, text="PWR", textcolor=color.white)

// Session backgrounds
bgcolor(inLondon ? color.new(#2196F3, 96) : na, title="London BG")
bgcolor(inNY ? color.new(#4CAF50, 96) : na, title="NY BG")
bgcolor(inPowerHour ? color.new(#FF9800, 96) : na, title="Power Hour BG")

// Stop/Target lines on signals
plot(longSignal ? longStop : na, "Long Stop", color.new(#FF5252, 0), 2, plot.style_linebr)
plot(longSignal ? longTarget : na, "Long Target", color.new(#00E676, 0), 2, plot.style_linebr)
plot(shortSignal ? shortStop : na, "Short Stop", color.new(#FF5252, 0), 2, plot.style_linebr)
plot(shortSignal ? shortTarget : na, "Short Target", color.new(#00E676, 0), 2, plot.style_linebr)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  INFO TABLE  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var table panel = table.new(position.top_right, 2, 14, bgcolor=color.new(color.black, 10), border_width=1, border_color=color.new(#333333, 0))

if barstate.islast
    // Header
    table.cell(panel, 0, 0, "YM", text_color=color.white, text_size=size.small, bgcolor=color.new(#2196F3, 30))
    table.cell(panel, 1, 0, "ğŸ¯SNIPER", text_color=color.white, text_size=size.small, bgcolor=color.new(#2196F3, 30))
    
    // Points & Tier
    color tierCol = isTierS ? sTierColor : isTierA ? aTierColor : isTierB ? bTierColor : color.white
    table.cell(panel, 0, 1, "Pts", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 1, str.tostring(candlePoints, "#.#"), text_color=tierCol, text_size=size.tiny)
    
    table.cell(panel, 0, 2, "Tier", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 2, tier, text_color=tierCol, text_size=size.tiny)
    
    // Volume
    color vCol = hasVolume ? color.green : hasStrongVolume ? color.lime : color.red
    table.cell(panel, 0, 3, "Vol", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 3, str.tostring(volRatio, "#.#") + "x", text_color=vCol, text_size=size.tiny)
    
    // Delta
    string dStr = buyPct > sellPct ? str.tostring(buyPct * 100, "#") + "%B" : str.tostring(sellPct * 100, "#") + "%S"
    color dCol = buyDominant ? color.new(#00E676, 0) : sellDominant ? color.new(#FF5252, 0) : color.white
    table.cell(panel, 0, 4, "Delta", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 4, dStr, text_color=dCol, text_size=size.tiny)
    
    // Body Ratio
    color bCol = hasStrongBody ? color.green : color.red
    table.cell(panel, 0, 5, "Body", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 5, str.tostring(currentBodyRatio * 100, "#") + "%", text_color=bCol, text_size=size.tiny)
    
    // CVD
    string cvdDir = cvdBullish ? "â–²" : "â–¼"
    color cvdCol = cvdBullish ? color.new(#00E676, 0) : color.new(#FF5252, 0)
    table.cell(panel, 0, 6, "CVD", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 6, cvdDir, text_color=cvdCol, text_size=size.tiny)
    
    // Session
    color sCol = inSession ? color.yellow : color.gray
    table.cell(panel, 0, 7, "Sess", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 7, currentSession, text_color=sCol, text_size=size.tiny)
    
    // POC
    table.cell(panel, 0, 8, "POC", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 8, str.tostring(currentPOC, format.mintick), text_color=pocColor, text_size=size.tiny)
    
    // Zone Status
    string zoneStatus = atBullZone ? "BUYâ¬š" : atBearZone ? "SELLâ¬š" : "---"
    color zoneCol = atBullZone ? color.new(#00E676, 0) : atBearZone ? color.new(#FF5252, 0) : color.white
    table.cell(panel, 0, 9, "Zone", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 9, zoneStatus, text_color=zoneCol, text_size=size.tiny)
    
    // Active Zones Count
    table.cell(panel, 0, 10, "Zones", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 10, str.tostring(activeBullZones) + "B/" + str.tostring(activeBearZones) + "S", text_color=color.white, text_size=size.tiny)
    
    // Confluence Score
    int activeScore = longSignal ? longConfluence : shortSignal ? shortConfluence : math.max(baseLong ? longConfluence : 0, baseShort ? shortConfluence : 0)
    color scoreCol = activeScore >= 7 ? color.lime : activeScore >= 5 ? color.yellow : color.gray
    table.cell(panel, 0, 11, "Score", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 11, str.tostring(activeScore) + "/10", text_color=scoreCol, text_size=size.tiny)
    
    // Imbalance Count
    int recentImbCount = 0
    for imb in imbalances
        if imb.barIdx >= bar_index - 10
            recentImbCount += 1
    table.cell(panel, 0, 12, "IMB", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 12, recentImbCount > 0 ? str.tostring(recentImbCount) : "-", text_color=recentImbCount > 0 ? color.yellow : color.gray, text_size=size.tiny)
    
    // R:R Display
    string rrStr = "---"
    if longSignal and not na(longStop) and not na(longTarget)
        float risk = close - longStop
        float reward = longTarget - close
        rrStr := "1:" + str.tostring(reward/risk, "#.#")
    else if shortSignal and not na(shortStop) and not na(shortTarget)
        float risk = shortStop - close
        float reward = close - shortTarget
        rrStr := "1:" + str.tostring(reward/risk, "#.#")
    table.cell(panel, 0, 13, "R:R", text_color=color.white, text_size=size.tiny)
    table.cell(panel, 1, 13, rrStr, text_color=(longSignal or shortSignal) ? color.lime : color.gray, text_size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  ALERTS  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Tiered Alerts
alertcondition(sLong, title="ğŸ¯ YM S-TIER LONG", message="ğŸ¯ğŸ¥‡ YM SNIPER S-TIER LONG {{ticker}} @ {{close}} | Score: " + str.tostring(longConfluence))
alertcondition(aLong, title="ğŸ¯ YM A-TIER LONG", message="ğŸ¯ğŸ¥ˆ YM SNIPER A-TIER LONG {{ticker}} @ {{close}}")
alertcondition(bLong, title="ğŸ¯ YM B-TIER LONG", message="ğŸ¯ğŸ¥‰ YM SNIPER B-TIER LONG {{ticker}} @ {{close}}")

alertcondition(sShort, title="ğŸ¯ YM S-TIER SHORT", message="ğŸ¯ğŸ¥‡ YM SNIPER S-TIER SHORT {{ticker}} @ {{close}}")
alertcondition(aShort, title="ğŸ¯ YM A-TIER SHORT", message="ğŸ¯ğŸ¥ˆ YM SNIPER A-TIER SHORT {{ticker}} @ {{close}}")
alertcondition(bShort, title="ğŸ¯ YM B-TIER SHORT", message="ğŸ¯ğŸ¥‰ YM SNIPER B-TIER SHORT {{ticker}} @ {{close}}")

// Zone Entry Alerts
alertcondition(dfzBuyEntry, title="ğŸ¯ YM ZONE BUY", message="ğŸŸ¢ YM ZONE BUY ENTRY {{ticker}} @ {{close}}")
alertcondition(dfzSellEntry, title="ğŸ¯ YM ZONE SELL", message="ğŸ”´ YM ZONE SELL ENTRY {{ticker}} @ {{close}}")

// Zone Creation Alerts
alertcondition(validBullZone, title="ğŸ“¦ NEW BULL ZONE", message="ğŸŸ© NEW YM BULLISH ZONE {{ticker}}")
alertcondition(validBearZone, title="ğŸ“¦ NEW BEAR ZONE", message="ğŸŸ¥ NEW YM BEARISH ZONE {{ticker}}")

// Single Print Alert
alertcondition(sniperSinglePrint, title="â­ SINGLE PRINT", message="â­ YM SINGLE PRINT {{ticker}} @ {{close}}")

// Session Alerts
alertcondition(londonStart, title="LONDON OPEN", message="London Open - YM Active")
alertcondition(nyStart, title="NY OPEN", message="NY Open - YM Active")
alertcondition(powerHourStart, title="POWER HOUR", message="Power Hour - YM Active")

// Master Alert with Full Info
if longSignal or shortSignal
    string t = tier
    string d = longSignal ? "LONG" : "SHORT"
    string act = isTierS ? "HOLD" : isTierA ? "SWING" : "SCALP"
    string deltaInfo = longSignal ? str.tostring(buyPct * 100, "#") + "%B" : str.tostring(sellPct * 100, "#") + "%S"
    string scoreInfo = " | Score: " + str.tostring(longSignal ? longConfluence : shortConfluence) + "/10"
    string zoneInfo = atBullZone or atBearZone ? " | IN ZONE" : ""
    string pocInfo = " | POC: " + str.tostring(currentPOC, format.mintick)
    string stopInfo = longSignal and not na(longStop) ? " | Stop: " + str.tostring(longStop, format.mintick) : shortSignal and not na(shortStop) ? " | Stop: " + str.tostring(shortStop, format.mintick) : ""
    alert("ğŸ¯ YM " + t + "-" + d + " | " + syminfo.ticker + " @ " + str.tostring(close, format.mintick) + " | " + deltaInfo + scoreInfo + zoneInfo + pocInfo + stopInfo + " | " + act, alert.freq_once_per_bar_close)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  END OF INDICATOR  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
